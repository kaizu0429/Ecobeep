<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test - EcoBeep</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f6fa;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-box h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #ecf0f1;
            border-radius: 4px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>üîß EcoBeep API Connection Diagnostic</h1>
    <p>This page will help identify why data isn't showing in Jeep Status.</p>

    <!-- Test 1: Check Current Page Location -->
    <div class="test-box">
        <h3>üìç Test 1: Page Location</h3>
        <div class="status info">
            <strong>Current Page URL:</strong> <span id="currentUrl"></span><br>
            <strong>Protocol:</strong> <span id="protocol"></span><br>
            <strong>Host:</strong> <span id="host"></span><br>
            <strong>Path:</strong> <span id="path"></span>
        </div>
        <div class="status warning">
            <strong>Recommended API URL:</strong> <span id="recommendedUrl"></span>
        </div>
    </div>

    <!-- Test 2: API Path Tests -->
    <div class="test-box">
        <h3>üîó Test 2: API Path Testing</h3>
        <p>Testing different possible API paths...</p>
        
        <button onclick="testApiPath('../php/jeep-status-api.php')">Test: ../php/jeep-status-api.php</button>
        <button onclick="testApiPath('/php/jeep-status-api.php')">Test: /php/jeep-status-api.php</button>
        <button onclick="testApiPath('/ecobeep/php/jeep-status-api.php')">Test: /ecobeep/php/jeep-status-api.php</button>
        <button onclick="testApiPath('php/jeep-status-api.php')">Test: php/jeep-status-api.php</button>
        
        <div class="result" id="pathTestResult">
            Click a button to test that path...
        </div>
    </div>

    <!-- Test 3: Test Specific API Actions -->
    <div class="test-box">
        <h3>‚ö° Test 3: API Actions</h3>
        <p>Enter the working API path from Test 2:</p>
        <input type="text" id="workingApiPath" placeholder="e.g., ../php/jeep-status-api.php" style="width: 300px; padding: 8px;">
        <br><br>
        
        <button onclick="testAction('test')">Test: Connection</button>
        <button onclick="testAction('get_vehicles')">Test: Get Vehicles</button>
        <button onclick="testAction('get_stats')">Test: Get Stats</button>
        <button onclick="testAction('get_all_data')">Test: Get All Data</button>
        
        <div class="result" id="actionTestResult">
            Results will appear here...
        </div>
    </div>

    <!-- Test 4: Database Check -->
    <div class="test-box">
        <h3>üíæ Test 4: Database Configuration</h3>
        <div class="status info">
            <p>Check if these settings in <code>jeep-status-api.php</code> are correct:</p>
            <pre>$host = 'localhost';
$dbname = 'ecobeep_db';  // ‚Üê Your database name
$username = 'root';      // ‚Üê Your MySQL username  
$password = '';          // ‚Üê Your MySQL password</pre>
        </div>
    </div>

    <!-- Test 5: Console Errors -->
    <div class="test-box">
        <h3>üêõ Test 5: JavaScript Console</h3>
        <div class="status warning">
            <p>Press <strong>F12</strong> to open Developer Tools, then check the <strong>Console</strong> tab for any errors.</p>
            <p>Common errors and what they mean:</p>
            <ul>
                <li><code>Failed to fetch</code> - API path is wrong or server isn't running</li>
                <li><code>CORS policy</code> - Need to add CORS headers to PHP file</li>
                <li><code>404 Not Found</code> - API file doesn't exist at that path</li>
                <li><code>500 Internal Server Error</code> - PHP error in the API file</li>
                <li><code>Unexpected token</code> - API is returning HTML instead of JSON (usually a PHP error)</li>
            </ul>
        </div>
        <button onclick="checkConsoleErrors()">Check Console Now</button>
        <div class="result" id="consoleResult"></div>
    </div>

    <script>
        // Test 1: Display current location
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('host').textContent = window.location.host;
        document.getElementById('path').textContent = window.location.pathname;
        
        // Recommend API URL based on current path
        const currentPath = window.location.pathname;
        let recommended = '../php/jeep-status-api.php';
        
        if (currentPath.includes('/ecobeep/')) {
            recommended = '/ecobeep/php/jeep-status-api.php';
        } else if (currentPath.includes('/html/')) {
            recommended = '../php/jeep-status-api.php';
        }
        
        document.getElementById('recommendedUrl').textContent = recommended;

        // Test 2: Test API Path
        async function testApiPath(path) {
            const resultDiv = document.getElementById('pathTestResult');
            resultDiv.innerHTML = `<p>Testing: <code>${path}</code>...</p>`;
            
            try {
                const response = await fetch(`${path}?action=test`);
                const contentType = response.headers.get('content-type');
                
                if (response.ok) {
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        resultDiv.innerHTML = `
                            <div class="status success">
                                ‚úÖ <strong>SUCCESS!</strong> This path works!<br>
                                Response: ${JSON.stringify(data, null, 2)}<br><br>
                                <strong>Use this in your jeep-status.js:</strong><br>
                                <code>const API_URL = '${path}';</code>
                            </div>
                        `;
                    } else {
                        const text = await response.text();
                        resultDiv.innerHTML = `
                            <div class="status error">
                                ‚ùå Path found but returned HTML instead of JSON<br>
                                This means there's a PHP error. Response:<br>
                                <pre>${text.substring(0, 500)}</pre>
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            ‚ùå HTTP ${response.status}: ${response.statusText}<br>
                            Path: <code>${path}</code>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå <strong>Error:</strong> ${error.message}<br>
                        This usually means the path is wrong or the server isn't running.
                    </div>
                `;
            }
        }

        // Test 3: Test specific API action
        async function testAction(action) {
            const apiPath = document.getElementById('workingApiPath').value;
            const resultDiv = document.getElementById('actionTestResult');
            
            if (!apiPath) {
                resultDiv.innerHTML = '<div class="status error">Please enter the working API path first!</div>';
                return;
            }
            
            resultDiv.innerHTML = `<p>Testing action: <code>${action}</code>...</p>`;
            
            try {
                const response = await fetch(`${apiPath}?action=${action}`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ <strong>Success!</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            ‚ùå <strong>API returned error:</strong><br>
                            ${data.message || JSON.stringify(data)}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        ‚ùå <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // Test 5: Check console errors
        function checkConsoleErrors() {
            const resultDiv = document.getElementById('consoleResult');
            resultDiv.innerHTML = `
                <div class="status info">
                    <p>‚úÖ JavaScript console is working!</p>
                    <p>Now open the Console tab (F12 ‚Üí Console) and look for any red error messages.</p>
                    <p>If you see errors, take a screenshot and share them.</p>
                </div>
            `;
            console.log('‚úÖ Console test: If you see this message in the Console tab, your JavaScript is working!');
            console.log('üîç Now check for any RED error messages above or below this.');
        }

        // Auto-run location test on load
        console.log('=== EcoBeep Diagnostic Tool ===');
        console.log('Current URL:', window.location.href);
        console.log('Recommended API path:', document.getElementById('recommendedUrl').textContent);
    </script>
</body>
</html>